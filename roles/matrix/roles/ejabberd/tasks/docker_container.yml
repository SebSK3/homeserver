- name: Make sure the ejabberd container is created and running
  become_user: ejabberd
  community.docker.docker_container:
    name: 'ejabberd'
    image: "ghcr.io/processone/ejabberd"
    pull: true
    state: 'started'
    ports:
      - "5222:5222"
      - "5347:5347"
      - "8443:8443"
      - "5280:5280"
    volumes:
      - "{{ docker_dir }}/{{ container_name }}/database:/opt/ejabberd/database"
      - "{{ docker_dir }}/{{ container_name }}/conf:/opt/ejabberd/conf"
      - "{{ docker_dir }}/{{ container_name }}/logs:/opt/ejabberd/logs"
      - "{{ docker_dir }}/{{ container_name }}/upload:/opt/ejabberd/upload"
      - "{{ docker_dir }}/{{ container_name }}/certs:/opt/ejabberd/certs"
    restart_policy: unless-stopped
